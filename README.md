Drools Diplom Project
Описание проекта
Проект Drools Diplom — это гибридное приложение на Java и Python, разработанное для помощи в диагностике острого коронарного синдрома (ОКС) с использованием системы правил Drools. Основная цель проекта — автоматизировать процесс оценки риска ОКС на основе медицинских данных пациента, таких как боль в груди, результаты ЭКГ, уровень тропонина, частота сердечных сокращений (ЧСС) и систолическое артериальное давление (АД). Система определяет уровень риска ("Высокий риск ОКС", "Низкий риск ОКС", "Критическое состояние" и т.д.) и предоставляет удобный интерфейс для ввода данных и просмотра результатов.
Проект состоит из двух основных компонентов:

Java-компонент: Использует Drools для выполнения правил диагностики и Spring Boot для предоставления веб-сервера.
Python-компонент: Управляет базой данных SQLite и предоставляет веб-интерфейс через Flask API.

Цели проекта

Обеспечить автоматизированную диагностику ОКС с помощью системы правил Drools.
Хранить данные пациентов и их визитов в базе данных SQLite для последующего анализа.
Предоставить удобный веб-интерфейс для ввода данных, получения диагноза и просмотра истории визитов.
Обеспечить модульность и переносимость приложения, чтобы его можно было легко развернуть на разных системах.

Структура проекта

src/main/java/com/example/drools/

Patient.java: Класс-модель для представления данных пациента (боль в груди, ЭКГ, тропонин, ЧСС, АД, диагноз).
RuleController.java: Контроллер Spring Boot, обрабатывающий запросы на диагностику через API /run-rules.
DroolsWebApplication.java: Главный класс Spring Boot приложения.


src/main/python/

database.py: Управляет базой данных SQLite (acs_diagnosis.db), хранящей данные пациентов и визитов.
api/CallDiagnosis_api.py: Flask API, предоставляющий веб-интерфейс и взаимодействующий с Java-сервисом.


src/main/resources/

rules/rules.drl: Файл правил Drools для диагностики ОКС.
templates/index.html: HTML-шаблон для веб-интерфейса Flask.
META-INF/kmodule.xml: Конфигурация Drools (определяет KieBase и KieSession).
acs_diagnosis.db: SQLite база данных (создаётся автоматически при запуске).


src/test/java/com/example/drools/

DroolsTest.java: Юнит-тесты для проверки правил Drools.


scripts/

build.sh: Скрипт для создания виртуального окружения, установки Python-зависимостей и сборки Java-проекта.
run_python.sh: Скрипт для инициализации базы данных и запуска Flask API.
run_java.sh: Скрипт для запуска Java-приложения.



Требования
Для работы с проектом вам понадобятся следующие инструменты:

Java 11:
Проверка: java -version
Установка (на Ubuntu): sudo apt install openjdk-11-jdk


Maven:
Проверка: mvn -version
Установка (на Ubuntu): sudo apt install maven


Python 3.8+:
Проверка: python3 --version
Установка (на Ubuntu): sudo apt install python3


python3-venv:
Установка (на Ubuntu): sudo apt install python3-venv


Bash:
Доступен по умолчанию на Linux/macOS. Для Windows используйте Git Bash или WSL.



Установка и настройка
Следуйте этим шагам для установки и запуска проекта:
1. Клонирование репозитория
Склонируйте репозиторий и перейдите в директорию проекта:
git clone <repository-url>
cd Drools_Diplom

2. Сборка проекта
Используйте скрипт build.sh для создания виртуального окружения, установки Python-зависимостей и сборки Java-проекта:
chmod +x scripts/build.sh
./scripts/build.sh

Этот скрипт:

Создаёт виртуальное окружение Python (venv/).
Устанавливает зависимости Python из requirements.txt (например, Flask).
Собирает Java-проект с помощью Maven, создавая JAR-файл в target/.

3. Запуск Python-компонентов
Запустите run_python.sh для инициализации базы данных и запуска Flask API:
chmod +x scripts/run_python.sh
./scripts/run_python.sh

Этот скрипт:

Запускает database.py для создания базы данных acs_diagnosis.db в src/main/resources/.
Запускает Flask API (CallDiagnosis_api.py) на http://localhost:5000.

4. Запуск Java-приложения
Запустите run_java.sh для старта Java-приложения:
chmod +x scripts/run_java.sh
./scripts/run_java.sh

Этот скрипт:

Запускает Spring Boot приложение на http://localhost:8080.

5. Доступ к приложению

Откройте браузер и перейдите по адресу http://localhost:5000.
Вы увидите веб-интерфейс, где можно вводить данные пациента, получать диагноз и просматривать историю визитов.

Использование
Ввод данных пациента

На странице http://localhost:5000 вы увидите форму для ввода данных:
Имя пациента.
Дата визита.
Боль в груди (да/нет).
Отклонения на ЭКГ (да/нет).
Повышенный уровень тропонина (да/нет).
Частота сердечных сокращений (ЧСС).
Систолическое артериальное давление (АД).


Нажмите "Сохранить", чтобы сохранить данные визита в базе.
Нажмите "Получить диагноз", чтобы отправить данные в Java-сервис и получить диагноз.

Просмотр истории пациентов

Слева на странице отображается список пациентов.
При выборе пациента вы увидите список его визитов.
При выборе визита данные автоматически загрузятся в форму для редактирования или повторной диагностики.

Запуск тестов
Проект включает юнит-тесты для проверки правил Drools. Чтобы запустить тесты:

Убедитесь, что проект собран (см. раздел "Сборка проекта").
Выполните тесты с помощью Maven:

mvn test


Тесты в DroolsTest.java проверяют логику диагностики ОКС для сценариев высокого и низкого риска.

Устранение неполадок
Проблемы с запуском Flask API

Ошибка TemplateNotFound: index.html:
Убедитесь, что файл index.html находится в src/main/resources/templates/.
Проверьте права доступа: chmod 644 src/main/resources/templates/index.html.


Flask не запускается:
Убедитесь, что виртуальное окружение активировано и Flask установлен (pip install flask внутри venv).
Проверьте, свободен ли порт 5000.



Проблемы с запуском Java-приложения

Ошибка The requested KieBase "defaultKieBase" does not exist:
Убедитесь, что kmodule.xml в src/main/resources/META-INF/ содержит <kbase name="defaultKieBase" packages="rules">.
Пересоберите проект: mvn clean && ./scripts/build.sh.


Java-приложение не запускается:
Убедитесь, что JAR-файл существует в target/ после сборки.
Проверьте, свободен ли порт 8080.



Проблемы с базой данных

База данных создаётся в неправильной директории:
Убедитесь, что database.py использует правильный путь: src/main/resources/acs_diagnosis.db.
Удалите старую базу данных: rm -f /root/Drools_Diplom/acs_diagnosis.db.


Ошибки базы данных:
Удалите файл acs_diagnosis.db и перезапустите run_python.sh, чтобы пересоздать базу данных.



Вклад в проект
Чтобы внести вклад в проект:

Сделайте форк репозитория.
Создайте ветку для новой функции: git checkout -b feature/your-feature.
Внесите изменения: git commit -m "Добавлена новая функция".
Отправьте изменения в ваш репозиторий: git push origin feature/your-feature.
Создайте запрос на включение (Pull Request).

Лицензия
Проект распространяется под лицензией MIT. Подробности см. в файле LICENSE (если применимо).
