# Drools Diplom Project

Добро пожаловать в **Drools Diplom Project**! Это современное гибридное приложение на Java и Python, созданное для автоматизации диагностики **острого коронарного синдрома (ОКС)** с использованием системы правил Drools. Проект сочетает мощь Java для обработки правил и удобство Python для создания веб-интерфейса, позволяя врачам быстро и эффективно оценивать риск ОКС у пациентов.

---

## Что это за проект?

**Drools Diplom** помогает в диагностике ОКС, анализируя ключевые медицинские параметры пациента, такие как:
- Боль в груди
- Отклонения на ЭКГ
- Уровень тропонина
- Частота сердечных сокращений (ЧСС)
- Систолическое артериальное давление (АД)

Система автоматически определяет уровень риска (например, "Высокий риск ОКС", "Низкий риск ОКС", "Критическое состояние") и сохраняет данные в базе SQLite для последующего анализа. Веб-интерфейс на Flask позволяет удобно вводить данные, получать диагноз и просматривать историю визитов пациентов.

### Основные цели проекта
- **Автоматизация диагностики**: Использовать Drools для применения медицинских правил.
- **Хранение данных**: Сохранять информацию о пациентах и их визитах в базе данных.
- **Удобный интерфейс**: Предоставить веб-интерфейс для ввода данных и просмотра результатов.
- **Переносимость**: Сделать проект легко разворачиваемым на разных системах.

---

## Структура проекта

Проект организован следующим образом:

- **`src/main/java/com/example/drools/`**  
  - `Patient.java` — Модель данных пациента (симптомы, диагноз).  
  - `RuleController.java` — Контроллер Spring Boot для обработки запросов диагностики.  
  - `DroolsWebApplication.java` — Главный класс Spring Boot приложения.

- **`src/main/python/`**  
  - `database.py` — Управление базой данных SQLite (`acs_diagnosis.db`).  
  - `api/CallDiagnosis_api.py` — Flask API для веб-интерфейса и взаимодействия с Java.

- **`src/main/resources/`**  
  - `rules/rules.drl` — Правила Drools для диагностики ОКС.  
  - `templates/index.html` — HTML-шаблон веб-интерфейса Flask.  
  - `META-INF/kmodule.xml` — Конфигурация Drools (определяет `KieBase` и `KieSession`).  
  - `acs_diagnosis.db` — SQLite база данных (создаётся автоматически).

- **`src/test/java/com/example/drools/`**  
  - `DroolsTest.java` — Юнит-тесты для проверки правил Drools.

- **`scripts/`**  
  - `build.sh` — Скрипт для сборки проекта.  
  - `run_python.sh` — Скрипт для запуска Python-компонентов.  
  - `run_java.sh` — Скрипт для запуска Java-приложения.

---

## Требования

Для работы с проектом установите следующие инструменты:

- **Java 11**  
  - Проверка: `java -version`  
  - Установка (Ubuntu): `sudo apt install openjdk-11-jdk`

- **Maven**  
  - Проверка: `mvn -version`  
  - Установка (Ubuntu): `sudo apt install maven`

- **Python 3.8+**  
  - Проверка: `python3 --version`  
  - Установка (Ubuntu): `sudo apt install python3`

- **python3-venv**  
  - Установка (Ubuntu): `sudo apt install python3-venv`

- **Bash**  
  - По умолчанию доступен на Linux/macOS. Для Windows используйте Git Bash или WSL.

---

## Установка и запуск

Следуйте этим шагам, чтобы запустить проект:

### 1. Клонирование репозитория
Склонируйте проект и перейдите в его директорию:

```bash
git clone <repository-url>
cd Drools_Diplom
```

### 2. Сборка проекта
Соберите проект с помощью скрипта `build.sh`:

```bash
chmod +x scripts/build.sh
./scripts/build.sh
```

**Что делает скрипт:**  
- Создаёт виртуальное окружение Python (`venv/`).  
- Устанавливает Python-зависимости из `requirements.txt` (например, Flask).  
- Собирает Java-проект с помощью Maven, создавая JAR-файл в `target/`.

### 3. Запуск Python-компонентов
Запустите Python-компоненты с помощью `run_python.sh`:

```bash
chmod +x scripts/run_python.sh
./scripts/run_python.sh
```

**Что делает скрипт:**  
- Инициализирует базу данных SQLite (`acs_diagnosis.db` в `src/main/resources/`).  
- Запускает Flask API на `http://localhost:5000`.

### 4. Запуск Java-приложения
Запустите Java-приложение с помощью `run_java.sh`:

```bash
chmod +x scripts/run_java.sh
./scripts/run_java.sh
```

**Что делает скрипт:**  
- Запускает Spring Boot приложение на `http://localhost:8080`.

### 5. Доступ к приложению
- Откройте браузер и перейдите на `http://localhost:5000`.  
- Вы увидите веб-интерфейс для ввода данных пациента и получения диагноза.

---

## Использование

### Ввод данных пациента
1. На странице `http://localhost:5000` вы увидите форму с полями:  
   - **Имя пациента** (обязательное поле).  
   - **Дата визита** (выберите дату и время).  
   - **Боль в груди** (чекбокс).  
   - **Отклонения на ЭКГ** (чекбокс).  
   - **Повышенный тропонин** (чекбокс).  
   - **ЧСС** (число, опционально).  
   - **Систолическое АД** (число, опционально).  
2. Нажмите **"Сохранить"**, чтобы сохранить данные визита в базе данных.  
3. Нажмите **"Получить диагноз"**, чтобы отправить данные в Java-сервис и получить результат.

### Просмотр истории пациентов
- **Список пациентов**: Слева отображается список всех пациентов.  
- **История визитов**: При выборе пациента вы увидите его визиты.  
- **Редактирование данных**: При выборе визита данные загрузятся в форму для повторной диагностики или редактирования.

---

## Запуск тестов

Проект включает юнит-тесты для проверки правил Drools:

1. Убедитесь, что проект собран (см. раздел "Сборка проекта").  
2. Запустите тесты с помощью Maven:

```bash
mvn test
```

- Тесты в `DroolsTest.java` проверяют логику диагностики для сценариев высокого и низкого риска ОКС.

---

## Устранение неполадок

### Проблемы с Flask API
- **Ошибка `TemplateNotFound: index.html`**  
  - Убедитесь, что `index.html` находится в `src/main/resources/templates/`.  
  - Проверьте права доступа: `chmod 644 src/main/resources/templates/index.html`.  

- **Flask не запускается**  
  - Проверьте, активировано ли виртуальное окружение (`source venv/bin/activate`).  
  - Убедитесь, что Flask установлен: `pip install flask`.  
  - Проверьте, свободен ли порт `5000`: `lsof -i :5000`.

### Проблемы с Java-приложением
- **Ошибка `The requested KieBase "defaultKieBase" does not exist`**  
  - Убедитесь, что `kmodule.xml` в `src/main/resources/META-INF/` содержит `<kbase name="defaultKieBase" packages="rules">`.  
  - Пересоберите проект: `mvn clean && ./scripts/build.sh`.  

- **Java-приложение не запускается**  
  - Проверьте наличие JAR-файла: `ls target/drools-project-1.0-SNAPSHOT.jar`.  
  - Убедитесь, что порт `8080` свободен: `lsof -i :8080`.

### Проблемы с базой данных
- **База данных создаётся в корне проекта**  
  - Убедитесь, что `database.py` указывает путь к `src/main/resources/acs_diagnosis.db`.  
  - Удалите старую базу: `rm -f /root/Drools_Diplom/acs_diagnosis.db`.  

- **Ошибки базы данных**  
  - Удалите файл базы данных: `rm -f src/main/resources/acs_diagnosis.db`.  
  - Перезапустите `run_python.sh`, чтобы пересоздать базу.

---

## Вклад в проект

Хотите улучшить проект? Следуйте этим шагам:

1. Сделайте форк репозитория.  
2. Создайте ветку для вашей функции: `git checkout -b feature/your-feature`.  
3. Внесите изменения и закоммитьте: `git commit -m "Добавлена новая функция"`.  
4. Отправьте изменения: `git push origin feature/your-feature`.  
5. Создайте Pull Request.

---

## Лицензия

Проект распространяется под лицензией **MIT**. Подробности см. в файле `LICENSE` (если применимо).

---

## Заключение

**Drools Diplom** — это мощный инструмент для автоматизации диагностики ОКС, который объединяет технологии Java и Python. Мы надеемся, что он будет полезен для медицинских специалистов и разработчиков, интересующихся применением систем правил в медицине. Если у вас есть вопросы или предложения, создавайте issue или Pull Request!